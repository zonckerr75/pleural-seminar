<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pleural Seminar Wales 2025 — Feedback</title>
  <meta name="description" content="Event feedback form with instant certificate generation and optional email." />
  <style>
    
:root{--bg:#0b1320;--panel:#0f172a;--fg:#e5e7eb;--muted:#94a3b8;--accent:#22c55e;--border:#1f2937}
/* Base */
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;padding-top:80px}
/* Fixed header */
header.nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:#0b1320;border-bottom:1px solid var(--border);box-shadow:0 2px 10px rgba(0,0,0,.4)}
.wrap{max-width:1100px;margin:0 auto;padding:0 16px}
.nav-inner{display:flex;align-items:center;justify-content:space-between;min-height:64px}
.brand{display:flex;align-items:center;gap:10px}
.brand h1{font-size:20px;margin:0}
.brand .dot{width:6px;height:6px;border-radius:50%;background:#22c55e;display:inline-block}
.nav-list{list-style:none;margin:0;padding:0;display:flex;gap:18px;align-items:center}
.nav-list a{color:#e5e7eb;text-decoration:none;padding:10px 6px;display:inline-block}
.nav-list a:hover{text-decoration:underline}

    /* Page layout */
    .page-wrap{max-width:980px;margin:0 auto;padding:22px}
    .card{background:var(--panel);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:22px}
    h1{margin:6px 0 8px;font-size:28px}
    h2{margin:20px 0 10px;font-size:20px;color:#fff}
    h3{margin:16px 0 8px;font-size:18px;color:#fff}
    p.small{color:var(--muted)}
    .form-group{margin:14px 0}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#052}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--fg)}
    textarea,input[type=text],input[type=email]{width:100%;background:#0b1220;color:#fff;border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    .progress{height:10px;background:#0b1220;border:1px solid var(--border);border-radius:999px;overflow:hidden;margin:8px 0 18px}
    .bar{height:100%;width:0%;background:var(--accent)}
    .likert label{display:block;margin:4px 0}
    .divider{border:0;border-top:1px solid var(--border);margin:18px 0}
    .row-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  </style>
</head>
<body>
  
<header class="nav">
  <div class="wrap nav-inner">
    <div class="brand">
      <span class="dot" aria-hidden="true"></span>
      <h1>Welsh Pleural Seminar 2025</h1>
    </div>
    <nav aria-label="Primary">
      <ul class="nav-list">
        <li><a href="/#programme">Agenda</a></li>
        <li><a href="/#house">Housekeeping</a></li>
        <li><a href="/#livestream">Livestream</a></li>
        <li><a href="/feedback.html">Feedback</a></li>
        <li><a href="/faculty.html" rel="nofollow">Faculty</a></li>
      </ul>
    </nav>
  </div>
</header>

  <div class="page-wrap">
    <div class="card">
      <h1>Pleural Seminar Wales 2025 – Evaluation</h1>
      <p class="small">Thank you for joining us. Please complete this short form. After submitting, you can instantly download or email your certificate.</p>

      <div class="progress" aria-label="Form progress"><div class="bar" id="progressBar"></div></div>
      <p class="small"><span id="progressText">0</span>/20 questions answered</p>

      <form id="feedback-form" name="feedback-form">
        <!-- Q1 -->
        <div class="form-group likert" data-q="1">
          <label><strong>1. How useful did you find this event?</strong></label>
          <label><input type="radio" name="q1" value="Extremely useful" required> Extremely useful</label>
          <label><input type="radio" name="q1" value="Useful"> Useful</label>
          <label><input type="radio" name="q1" value="Fairly useful"> Fairly useful</label>
          <label><input type="radio" name="q1" value="Not useful"> Not useful</label>
        </div>
        <!-- Q2 -->
        <div class="form-group likert" data-q="2">
          <label><strong>2. What was your overall impression of the programme of this event?</strong></label>
          <label><input type="radio" name="q2" value="Excellent" required> Excellent</label>
          <label><input type="radio" name="q2" value="Good"> Good</label>
          <label><input type="radio" name="q2" value="Fairly good"> Fairly good</label>
          <label><input type="radio" name="q2" value="Poor"> Poor</label>
          <label><input type="radio" name="q2" value="Very poor"> Very poor</label>
        </div>
        <!-- Q3 -->
        <div class="form-group likert" data-q="3">
          <label><strong>3. What was your overall impression of the organisation of this event?</strong></label>
          <label><input type="radio" name="q3" value="Excellent" required> Excellent</label>
          <label><input type="radio" name="q3" value="Good"> Good</label>
          <label><input type="radio" name="q3" value="Fairly good"> Fairly good</label>
          <label><input type="radio" name="q3" value="Poor"> Poor</label>
          <label><input type="radio" name="q3" value="Very poor"> Very poor</label>
        </div>
<!-- Sessions (Q4–Q14) -->
<hr class="divider">
<h3>Sessions (Q4–Q14)</h3>

<div class="form-group likert" data-q="4">
  <label><strong>Q4 — ‘Diagnostic Pathway in MPE – New Data on “Straight-to-Biopsy”’ by Prof. Naj Rahman</strong></label>
  <label><input type="radio" name="q4" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q4" value="4"> Useful</label>
  <label><input type="radio" name="q4" value="3"> Fairly useful</label>
  <label><input type="radio" name="q4" value="2"> Not useful</label>
  <label><input type="radio" name="q4" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="5">
  <label><strong>Q5 — ‘Update in Mesothelioma Research – HIT-MESO Trial’ by Dr. Paul Shaw</strong></label>
  <label><input type="radio" name="q5" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q5" value="4"> Useful</label>
  <label><input type="radio" name="q5" value="3"> Fairly useful</label>
  <label><input type="radio" name="q5" value="2"> Not useful</label>
  <label><input type="radio" name="q5" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="6">
  <label><strong>Q6 — ‘Local Anaesthetic Thoracoscopy’ by Dr. Richard Westley</strong></label>
  <label><input type="radio" name="q6" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q6" value="4"> Useful</label>
  <label><input type="radio" name="q6" value="3"> Fairly useful</label>
  <label><input type="radio" name="q6" value="2"> Not useful</label>
  <label><input type="radio" name="q6" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="7">
  <label><strong>Q7 — ‘Clinical Applications of Artificial Intelligence’ by Prof. Alan Fraser</strong></label>
  <label><input type="radio" name="q7" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q7" value="4"> Useful</label>
  <label><input type="radio" name="q7" value="3"> Fairly useful</label>
  <label><input type="radio" name="q7" value="2"> Not useful</label>
  <label><input type="radio" name="q7" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="8">
  <label><strong>Q8 — ‘A Pathway for the Management of Hepatic Hydrothorax’ by Dr. Sam Ryan</strong></label>
  <label><input type="radio" name="q8" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q8" value="4"> Useful</label>
  <label><input type="radio" name="q8" value="3"> Fairly useful</label>
  <label><input type="radio" name="q8" value="2"> Not useful</label>
  <label><input type="radio" name="q8" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="9">
  <label><strong>Q9 — ‘Legal Aspects in Asbestos-related Pleural Disease’ by speaker from Irwin Mitchell</strong></label>
  <label><input type="radio" name="q9" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q9" value="4"> Useful</label>
  <label><input type="radio" name="q9" value="3"> Fairly useful</label>
  <label><input type="radio" name="q9" value="2"> Not useful</label>
  <label><input type="radio" name="q9" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="10">
  <label><strong>Q10 — ‘Thoracic Ultrasound Training’ by Dr. Rebecca Pearce</strong></label>
  <label><input type="radio" name="q10" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q10" value="4"> Useful</label>
  <label><input type="radio" name="q10" value="3"> Fairly useful</label>
  <label><input type="radio" name="q10" value="2"> Not useful</label>
  <label><input type="radio" name="q10" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="11">
  <label><strong>Q11 — ‘How Did We Manage Pneumothoraces?’ by Dr. Natnael Afesha</strong></label>
  <label><input type="radio" name="q11" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q11" value="4"> Useful</label>
  <label><input type="radio" name="q11" value="3"> Fairly useful</label>
  <label><input type="radio" name="q11" value="2"> Not useful</label>
  <label><input type="radio" name="q11" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="12">
  <label><strong>Q12 — ‘Outcomes of Empyema’ by Dr. Nora Ramley</strong></label>
  <label><input type="radio" name="q12" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q12" value="4"> Useful</label>
  <label><input type="radio" name="q12" value="3"> Fairly useful</label>
  <label><input type="radio" name="q12" value="2"> Not useful</label>
  <label><input type="radio" name="q12" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="13">
  <label><strong>Q13 — ‘Ten Years of Ambulatory Pleural Procedure Service at SBUHB’ by Dr. N. Chinnappa</strong></label>
  <label><input type="radio" name="q13" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q13" value="4"> Useful</label>
  <label><input type="radio" name="q13" value="3"> Fairly useful</label>
  <label><input type="radio" name="q13" value="2"> Not useful</label>
  <label><input type="radio" name="q13" value="1"> Not relevant</label>
</div>

<div class="form-group likert" data-q="14">
  <label><strong>Q14 — Case Presentation session</strong></label>
  <label><input type="radio" name="q14" value="5" required> Extremely useful</label>
  <label><input type="radio" name="q14" value="4"> Useful</label>
  <label><input type="radio" name="q14" value="3"> Fairly useful</label>
  <label><input type="radio" name="q14" value="2"> Not useful</label>
  <label><input type="radio" name="q14" value="1"> Not relevant</label>
</div>

       
        <hr class="divider">

        <!-- Free text -->
        <div class="form-group" data-q="15">
          <label for="q15"><strong>15. What was the best aspect of this event?</strong></label>
          <textarea id="q15" name="q15" rows="3" placeholder="Type your response here..." required></textarea>
        </div>
        <div class="form-group" data-q="16">
          <label for="q16"><strong>16. What was the worst aspect of this event?</strong></label>
          <textarea id="q16" name="q16" rows="3" placeholder="Type your response here..." required></textarea>
        </div>
        <div class="form-group" data-q="17">
          <label for="q17"><strong>17. What impact will this event have on your future practice?</strong></label>
          <textarea id="q17" name="q17" rows="3" placeholder="Type your response here..." required></textarea>
        </div>
        <div class="form-group" data-q="18">
          <label for="q18"><strong>18. Any additional comments or suggestions for future topics of discussion?</strong></label>
          <textarea id="q18" name="q18" rows="3" placeholder="Type your response here..." required></textarea>
        </div>
        <div class="form-group" data-q="19">
          <label for="q19"><strong>19. Enter your name as it should appear on your certificate</strong></label>
          <input type="text" id="q19" name="certificate_name" placeholder="Your full name" required>
        </div>
        <div class="form-group" data-q="20">
          <label for="q20"><strong>20. Email address</strong></label>
          <input type="email" id="q20" name="email" placeholder="you@example.com" required>
        </div>

        <div class="row-actions">
          <button type="submit" class="btn primary">Submit Feedback</button>
          <button type="button" id="saveDraft" class="btn ghost" title="Saves in this browser only">Save draft</button>
          <button type="button" id="clearDraft" class="btn ghost" title="Clears saved draft">Clear</button>
        </div>

        <div id="cert-actions" style="display:none; margin-top:24px;">
          <hr class="divider">
          <h2>Your certificate</h2>
          <p class="small">Choose how you’d like to receive it:</p>
          <div class="row-actions">
            <button type="button" id="downloadCert" class="btn primary">Download Certificate</button>
            <button type="button" id="emailCert" class="btn ghost" title="Email option will be available shortly.">Email Certificate</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script>
    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

    const totalQs = 20;
    function updateProgress(){
      const answered = $$('[data-q] input:checked, [data-q] textarea:valid, [data-q] input[type="text"]:valid, [data-q] input[type="email"]:valid')
        .filter((el)=>{ const group = el.closest('[data-q]'); if(!group) return false; group.dataset._counted = '1'; return true; }).length;
      const unique = $$('[data-q]').filter(g=>g.dataset._counted==='1').length;
      $$('[data-q]').forEach(g=>delete g.dataset._counted);
      $('#progressText').textContent = unique;
      $('#progressBar').style.width = Math.min(100, Math.round((unique/totalQs)*100)) + '%';
    }

    function enableKeyboardLikert(){
      $$('.likert').forEach(group=>{
        group.addEventListener('keydown', (e)=>{
          const radios = $$('input[type="radio"]', group);
          const current = radios.findIndex(r=>r.checked);
          const key = e.key;
          if(/^[1-5]$/.test(key)){
            const idx = parseInt(key,10)-1;
            if(radios[idx]){ radios[idx].checked = true; radios[idx].focus(); e.preventDefault(); updateProgress(); }
          } else if(key==='ArrowRight' || key==='ArrowDown'){
            const next = Math.min(radios.length-1, (current<0?0:current+1));
            radios[next]?.focus(); e.preventDefault();
          } else if(key==='ArrowLeft' || key==='ArrowUp'){
            const prev = Math.max(0, (current<0?0:current-1));
            radios[prev]?.focus(); e.preventDefault();
          }
        });
      });
    }

    function serializeForm(form){ const fd = new FormData(form); const obj={}; for(const [k,v] of fd.entries()) obj[k]=v; return obj; }
    function saveDraft(form){ localStorage.setItem('psw25_feedback', JSON.stringify(serializeForm(form))); }
    function loadDraft(form){ const raw=localStorage.getItem('psw25_feedback'); if(!raw) return; const data=JSON.parse(raw); for(const k in data){ const el=form.elements[k]; if(!el) continue; if(el instanceof RadioNodeList){ const r=form.querySelector(`input[name=${k}][value='${data[k]}']`); if(r) r.checked=true; } else { el.value=data[k]; } } }

    async function fetchBasePdf(){ const urls=['/assets/cert/certificate.pdf','assets/cert/certificate.pdf']; for(const u of urls){ try{ const r=await fetch(u,{cache:'no-store'}); if(r.ok) return await r.arrayBuffer(); }catch(_ ){} } throw new Error('Cannot load /assets/cert/certificate.pdf'); }
    async function buildPdf(name){ const { PDFDocument, StandardFonts, rgb } = PDFLib; const base=await fetchBasePdf(); const pdf=await PDFDocument.load(base); const page=pdf.getPage(0); const {width:W,height:H}=page.getSize(); const font=await pdf.embedFont(StandardFonts.HelveticaBold); const size=24; const y=H-(7*72/2.54); const x=(W - font.widthOfTextAtSize(name,size))/2; page.drawText(name,{x,y,size,font,color:rgb(0,0,0)}); return await pdf.save(); }
    async function downloadCertificate(name){ const bytes=await buildPdf(name); const blob=new Blob([bytes],{type:'application/pdf'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`Pleural Seminar Wales 2025 - Certificate - ${name}.pdf`; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),1500); }
    async function emailCertificate(name,email){ const bytes=await buildPdf(name); const b=new Uint8Array(bytes); let bin=''; for(let i=0;i<b.length;i++) bin+=String.fromCharCode(b[i]); const pdfBase64=btoa(bin); const resp=await fetch('/api/email',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,pdfBase64})}); if(!resp.ok) throw new Error(await resp.text()); }
    async function checkEmailAvailability(){ const btn=$('#emailCert'); if(!btn) return; btn.disabled=true; try{ const r=await fetch('/api/email',{method:'GET'}); if(r.status===200||r.status===405){ btn.disabled=false; btn.title=''; } }catch(_ ){} }

    window.addEventListener('DOMContentLoaded',()=>{
      const form=$('#feedback-form');
      enableKeyboardLikert();
      loadDraft(form);
      updateProgress();
      form.addEventListener('input', updateProgress);
      $('#saveDraft').addEventListener('click', ()=>{ saveDraft(form); alert('Draft saved on this device.'); });
      $('#clearDraft').addEventListener('click', ()=>{ localStorage.removeItem('psw25_feedback'); location.reload(); });
      form.addEventListener('submit',(e)=>{ if(!form.checkValidity()) return; e.preventDefault(); $('#cert-actions').style.display='block'; $('#cert-actions').scrollIntoView({behavior:'smooth'}); });
      $('#downloadCert').addEventListener('click', async ()=>{ const name=$('#q19').value.trim(); if(!name) return alert('Please enter your name (Q19).'); await downloadCertificate(name); });
      $('#emailCert').addEventListener('click', async ()=>{ const name=$('#q19').value.trim(); const email=$('#q20').value.trim(); if(!name||!email) return alert('Please complete Q19 (name) and Q20 (email).'); try{ await emailCertificate(name,email); alert('Certificate emailed. Please check your inbox (and spam).'); }catch(e){ alert('Email failed: '+(e?.message||e)); } });
      checkEmailAvailability();
    });
  </script>

  <!-- Firebase save -->
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAZq933hFxLT1K49auoZjBnYWEdi2mKUFI",
      authDomain: "pleural-seminar-2025.firebaseapp.com",
      projectId: "pleural-seminar-2025",
      storageBucket: "pleural-seminar-2025.appspot.com",
      messagingSenderId: "914784082205",
      appId: "1:914784082205:web:448e2d4fe8e9579075a9f4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('feedback-form');
      if (!form) return;
      form.addEventListener('submit', async (e) => {
        if (!form.checkValidity()) return;
        const formData = new FormData(form);
        const responses = {};
        for (const [key, value] of formData.entries()) responses[key] = value;
        try {
          await db.collection('feedback').add({
            responses,
            submittedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          console.log('✅ Feedback saved to Firestore');
        } catch (err) {
          console.error('⚠️ Error saving feedback:', err);
        }
      });
    });
  </script>

<script>
  (async function(){
    try{
      const res = await fetch('/assets/feedback-questions.json', {cache:'no-store'});
      if(!res.ok) return;
      const qText = await res.json();
      for(let q=4;q<=14;q++){
        const strong = document.querySelector(`.form-group[data-q="${q}"] label strong`);
        if(strong && qText[`q${q}`]) strong.textContent = qText[`q${q}`];
      }
    }catch(_){ /* ignore */ }
  })();
</script>

</body>
</html>
