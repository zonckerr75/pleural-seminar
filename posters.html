<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Posters — Pleural Seminar Wales 2025</title>
  <meta name="color-scheme" content="dark light">
  <style>
    :root{
      --bg:#0b1320;--panel:#0f172a;--fg:#e5e7eb;--muted:#94a3b8;--accent:#22c55e;--border:#1f2937;
    }
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      display:flex;min-height:100vh
    }
    /* Optional sidebar placeholder */
    aside.nav{
      width:260px;background:var(--panel);border-right:1px solid var(--border);
      position:sticky;top:0;height:100vh;padding:20px;display:none
    }
    @media (min-width: 1024px){ aside.nav{display:block} }
    main{flex:1;min-width:0;padding:20px}
    header.page{display:flex;flex-direction:column;gap:6px;margin-bottom:16px}
    header.page h1{font-size:22px;margin:0}
    header.page p{color:var(--muted);margin:0}

    /* Grid */
    .grid{
      display:grid;gap:12px;
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    @media (min-width: 640px){ .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (min-width: 1024px){ .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (min-width: 1280px){ .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } }

    /* Card */
    .card{
      background:var(--panel);border:1px solid var(--border);border-radius:14px;
      overflow:hidden;display:flex;flex-direction:column;min-height:200px
    }
    .thumb{
      aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;
      border-bottom:1px solid var(--border);position:relative;background:#0c1527
    }
    .thumb img{
      width:100%;height:100%;object-fit:contain;display:block;
    }
    .badge{
      position:absolute;top:8px;left:8px;background:rgba(34,197,94,.15);color:#86efac;
      font-weight:600;font-size:12px;padding:3px 7px;border-radius:999px;border:1px solid rgba(134,239,172,.3)
    }
    .info{padding:10px}
    .title{font-weight:600;margin:0 0 4px 0;font-size:15px;line-height:1.3}
    .meta{color:var(--muted);font-size:13px;margin:0}
    .open{ text-decoration:none;color:var(--fg);display:block }
    .open:focus-visible{outline:2px solid var(--accent);outline-offset:4px;border-radius:12px}

    .notice{color:var(--muted);margin-top:8px;font-size:14px}
  </style>
</head>
<body>
  <aside class="nav">
    <h3 style="margin-top:0">Pleural Seminar</h3>
    <nav>
      <a href="index.html" style="display:block;color:var(--fg);margin:8px 0">Home</a>
      <a href="venue.html" style="display:block;color:var(--fg);margin:8px 0">Venue</a>
      <a href="faculty.html" style="display:block;color:var(--fg);margin:8px 0">Faculty</a>
      <a href="feedback.html" style="display:block;color:var(--fg);margin:8px 0">Feedback</a>
      <a href="about.html" style="display:block;color:var(--fg);margin:8px 0">About</a>
      <span style="display:block;color:var(--muted);margin:8px 0">Posters</span>
    </nav>
  </aside>

  <main>
    <header class="page">
      <h1>Posters</h1>
      <p>Tap a thumbnail to open the PDF in a new tab.</p>
      <p class="notice">Uses <code>assets/posters/posters.csv</code> to list posters. Thumbnails are expected as <code>p01.jpg</code> etc. PDFs as <code>P01.pdf</code>.</p>
    </header>

    <section class="grid" id="posterGrid" aria-live="polite"></section>
  </main>

  <script>
  (function(){
    const grid = document.getElementById('posterGrid');

    // Config: CSV + paths
    const PREFIX = 'assets/posters/';
    const CSV_URL = PREFIX + 'posters.csv';

    // Image size hints for sharper picks
    const SIZES_ATTR = '(min-width:1280px) 22vw, (min-width:1024px) 30vw, (min-width:640px) 44vw, 92vw';

    function parseCSV(text){
      const rows = [];
      const lines = text.split(/[\r\n]+/).filter(Boolean);
      const header = lines[0].toLowerCase();
      let start = 0;
      if (header.startsWith('id,')) start = 1;
      for (let i=start;i<lines.length;i++){
        const parts = lines[i].split(',').map(s=>s.trim());
        if (parts.length >= 3){
          const id = parts[0];
          const title = parts[1];
          const authors = parts.slice(2).join(', ');
          rows.push({ id, title, authors });
        }
      }
      return rows;
    }

    function buildCard(row, idx){
      const id = row.id;
      const pdfUrl = PREFIX + id + '.pdf';

      // Thumbnail candidates in common casings
      const base = id.toLowerCase(); // prefer p01.jpg etc.
      const candidates = [
        PREFIX + base + '.jpg',
        PREFIX + id + '.jpg',
        PREFIX + id.toUpperCase() + '.jpg',
        PREFIX + base + '.png',
        PREFIX + id + '.png',
        PREFIX + base + '.webp',
        PREFIX + id + '.webp',
      ];

      const a = document.createElement('a');
      a.href = pdfUrl; a.target = '_blank'; a.rel = 'noopener'; a.className = 'open';

      const card = document.createElement('article'); card.className = 'card';

      const thumb = document.createElement('div'); thumb.className = 'thumb';
      const img = document.createElement('img'); img.loading = 'lazy'; img.decoding = 'async';
      img.alt = (row.title ? row.title + ' — ' : '') + id + ' thumbnail';
      img.sizes = SIZES_ATTR;

      // Set first candidate, and chain fallbacks on error
      img.dataset.fallbacks = candidates.slice(1).join('|');
      img.src = candidates[0];
      img.onerror = function(){
        const list = (this.dataset.fallbacks || '').split('|').filter(Boolean);
        if (!list.length) { this.onerror = null; this.style.display='none'; return; }
        this.src = list.shift();
        this.dataset.fallbacks = list.join('|');
      };

      const badge = document.createElement('span'); badge.className = 'badge'; badge.textContent = id;

      thumb.appendChild(img); thumb.appendChild(badge);

      const info = document.createElement('div'); info.className = 'info';
      const title = document.createElement('h3'); title.className = 'title'; title.textContent = row.title || id;
      const meta = document.createElement('p'); meta.className = 'meta'; meta.textContent = row.authors || 'Tap to open';

      info.appendChild(title); info.appendChild(meta);
      card.appendChild(thumb); card.appendChild(info); a.appendChild(card);

      return a;
    }

    async function init(){
      try{
        const res = await fetch(CSV_URL, { cache:'no-store' });
        if (!res.ok) throw new Error('posters.csv not found');
        const text = await res.text();
        const rows = parseCSV(text);

        if (!rows.length){
          const p = document.createElement('p');
          p.style.color = 'var(--muted)';
          p.textContent = 'No entries in posters.csv';
          grid.appendChild(p);
          return;
        }

        // Sort by numeric ID if possible
        rows.sort((a,b)=> a.id.localeCompare(b.id, undefined, { numeric:true }));

        rows.forEach((row, idx)=> grid.appendChild(buildCard(row, idx)));
      } catch (e){
        const p = document.createElement('p');
        p.style.color = 'var(--muted)';
        p.textContent = 'Could not load posters.csv — please ensure it exists at assets/posters/posters.csv';
        grid.appendChild(p);
        console.warn(e);
      }
    }

    init();
  })();
  </script>
</body>
</html>
