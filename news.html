<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>News &amp; Events — Pleural Seminar Wales</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-color: #020617;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-color: #1f2937;
      --radius-lg: 18px;
      --radius-sm: 8px;
      --shadow-soft: 0 24px 50px rgba(15, 23, 42, 0.85);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top, rgba(15, 23, 42, 0.9), transparent 55%),
        radial-gradient(circle at bottom, rgba(15, 23, 42, 0.9), #020617 60%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .shell {
      width: 100%;
      max-width: 1100px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.99));
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 18px 20px 24px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .shell {
        padding: 22px 30px 26px;
      }
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.06), transparent 55%);
      opacity: 0.5;
      pointer-events: none;
    }

    .content {
      position: relative;
      z-index: 1;
    }

    /* Top navigation */
    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      margin-bottom: 18px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      padding-bottom: 10px;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-logo {
      width: 40px;
      height: auto;
      border-radius: 6px;
      background: none;
      box-shadow: none;
      display: block;
    }

    .nav-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .nav-title-main {
      font-size: 0.98rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .nav-title-sub {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.86rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .nav-link {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      color: var(--text-muted);
      text-decoration: none;
      background: transparent;
      transition: all 0.16s ease-out;
    }

    .nav-link:hover {
      color: var(--text-main);
      border-color: rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
    }

    .nav-link.active {
      color: #e0f2fe;
      border-color: rgba(56, 189, 248, 0.9);
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.18), rgba(15, 23, 42, 0.95));
      box-shadow: 0 12px 26px rgba(8, 47, 73, 0.8);
    }

    @media (max-width: 640px) {
      .nav {
        flex-direction: column;
        align-items: flex-start;
      }
      .nav-links {
        justify-content: flex-start;
      }
    }

    /* Page header */
    .page-header {
      margin-top: 6px;
      margin-bottom: 18px;
    }

    .page-kicker {
      font-size: 0.78rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 4px;
    }

    .page-title-row {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 10px;
      justify-content: space-between;
    }

    .page-title-main {
      font-size: 1.45rem;
      letter-spacing: 0.03em;
    }

    .pill {
      font-size: 0.72rem;
      padding: 2px 9px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.8);
      background: rgba(15, 23, 42, 0.9);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .page-subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
      max-width: 640px;
      margin-top: 6px;
    }

    /* Filters / controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .controls-left {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .filter-pill {
      font-size: 0.78rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s ease-out;
    }

    .filter-pill.active {
      border-color: rgba(56, 189, 248, 0.95);
      color: #e0f2fe;
      background: rgba(15, 23, 42, 1);
    }

    .controls-right {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    /* News list */
    .news-panel {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 1rem;
      border: 1px solid rgba(15, 23, 42, 0.98);
      box-shadow: 0 22px 45px rgba(15, 23, 42, 0.85);
      padding: 1.3rem 1.5rem 1.6rem;
    }

    @media (max-width: 640px) {
      .news-panel {
        padding: 1.1rem 1.1rem 1.4rem;
      }
    }

    .status-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.18);
    }

    .status-dot.error {
      background: #f97373;
      box-shadow: 0 0 0 6px rgba(248, 113, 113, 0.22);
    }

    .status-label {
      font-weight: 500;
      color: #e5e7eb;
    }

    .news-empty {
      font-size: 0.85rem;
      color: var(--text-muted);
      padding: 0.8rem 0;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .news-card {
      border-radius: 0.9rem;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), #020617);
      padding: 0.85rem 0.9rem 0.9rem;
      box-shadow: 0 16px 32px rgba(15, 23, 42, 0.85);
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 0.35rem;
    }

    @media (min-width: 720px) {
      .news-card {
        grid-template-columns: minmax(0, 1fr) auto;
        align-items: flex-start;
      }
    }

    .news-main {
      min-width: 0;
    }

    .news-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-bottom: 2px;
    }

    .news-date {
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .news-category {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(37, 99, 235, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: #bfdbfe;
    }

    .news-pinned {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(250, 204, 21, 0.12);
      border: 1px solid rgba(234, 179, 8, 0.8);
      color: #facc15;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .news-title {
      font-size: 0.98rem;
      margin: 0 0 2px;
    }

    .news-title a,
    .news-title a:visited {
      color: #e5e7eb;
      text-decoration: none;
    }

    .news-title a:hover {
      color: #f9fafb;
      text-decoration: underline;
    }

    .news-summary {
      font-size: 0.84rem;
      color: var(--text-muted);
      margin: 0;
    }

    .news-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .news-link-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 0.78rem;
      padding: 6px 12px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .news-link-btn:hover {
      border-color: rgba(56, 189, 248, 0.9);
      color: #e0f2fe;
      background: rgba(15, 23, 42, 1);
    }

    .news-origin {
      font-size: 0.72rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <main class="shell">
    <div class="content">
      <header class="nav">
        <div class="nav-brand">
          <img src="assets/branding/logo.png" class="nav-logo" alt="PleuraWales logo" />
          <div class="nav-title">
            <div class="nav-title-main">Pleural Seminar Wales</div>
            <div class="nav-title-sub">News &amp; events</div>
          </div>
        </div>
        <nav class="nav-links" aria-label="Primary">
          <a href="index.html" class="nav-link">Home</a>
          <a href="news.html" class="nav-link active">News &amp; Events</a>
          <a href="about.html" class="nav-link">About</a>
          <a href="members.html" class="nav-link">Members</a>
        </nav>
      </header>

      <header class="page-header">
        <div class="page-kicker">PleuraWales Portal</div>
        <div class="page-title-row">
          <div class="page-title-main">News &amp; events</div>
          </div>
        <p class="page-subtitle">
          Updates on local pleural service activity, national meetings, guidelines, and key studies or trials of interest.
          Items on this page are loaded from the PleuraWales Firestore database so they can be updated without changing
          the site code.
        </p>
      </header>

      <section class="controls" aria-label="News filters">
        <div class="controls-left">
          <button type="button" class="filter-pill active" data-filter="all">All</button>
          <button type="button" class="filter-pill" data-filter="Trial">Trials</button>
          <button type="button" class="filter-pill" data-filter="Guidelines">Guidelines</button>
          <button type="button" class="filter-pill" data-filter="Event">Events</button>
          <button type="button" class="filter-pill" data-filter="Service">Service updates</button>
        </div>
        <div class="controls-right">
          Showing latest items first. Pinned updates appear at the top.
        </div>
      </section>

      <section class="news-panel" aria-label="News list">
        <div class="status-row" id="status-loading">
          <span class="status-dot"></span>
          <span class="status-label">Loading</span>
          <span>– fetching the latest news from the PleuraWales database.</span>
        </div>
        <div class="status-row" id="status-error" style="display:none;">
          <span class="status-dot error"></span>
          <span class="status-label">Unable to load news.</span>
          <span>Please check your connection or try again later.</span>
        </div>

        <div id="newsList" class="news-list" aria-live="polite"></div>
        <div id="newsEmpty" class="news-empty" style="display:none;">
          No news items found yet. Once entries are added to the <code>news</code> collection in Firestore, they will
          appear here automatically.
        </div>
      </section>
    </div>
  </main>

  <script type="module">
    // TODO: Replace this config with the same Firebase configuration used on your other pages.
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      orderBy,
      getDocs
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
    apiKey: "AIzaSyAZq933hFxLT1K49auoZjBnYWEdi2mKUFI",
    authDomain: "pleural-seminar-2025.firebaseapp.com",
    projectId: "pleural-seminar-2025",
    storageBucket: "pleural-seminar-2025.appspot.com",
    messagingSenderId: "914784082205",
    appId: "1:1:914784082205:web:448e2d4fe8e9579075a9f4"

};

    let app, db;
    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    } catch (e) {
      console.warn("Firebase initialisation problem:", e);
    }

    const newsListEl = document.getElementById("newsList");
    const newsEmptyEl = document.getElementById("newsEmpty");
    const statusLoading = document.getElementById("status-loading");
    const statusError = document.getElementById("status-error");
    const filterButtons = document.querySelectorAll(".filter-pill");

    let allItems = [];
    let currentFilter = "all";

    function formatDate(ts) {
      if (!ts) return "";
      // Firestore Timestamp -> JS Date
      const d = ts.toDate ? ts.toDate() : new Date(ts);
      return d.toLocaleDateString("en-GB", {
        day: "2-digit",
        month: "short",
        year: "numeric"
      });
    }

    function originFromUrl(url) {
      try {
        const u = new URL(url);
        return u.hostname.replace(/^www\./, "");
      } catch {
        return "";
      }
    }

    function applyFilter(filter) {
      currentFilter = filter;
      filterButtons.forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.filter === filter);
      });

      const visible = allItems.filter((item) => {
        if (filter === "all") return true;
        return (item.category || "").toLowerCase() === filter.toLowerCase();
      });

      renderNews(visible);
    }

    function renderNews(items) {
      newsListEl.innerHTML = "";
      if (!items.length) {
        newsEmptyEl.style.display = "block";
        return;
      }
      newsEmptyEl.style.display = "none";

      for (const item of items) {
        const card = document.createElement("article");
        card.className = "news-card";

        const main = document.createElement("div");
        main.className = "news-main";

        const metaRow = document.createElement("div");
        metaRow.className = "news-meta-row";

        if (item.date) {
          const d = document.createElement("span");
          d.className = "news-date";
          d.textContent = formatDate(item.date);
          metaRow.appendChild(d);
        }

        if (item.category) {
          const c = document.createElement("span");
          c.className = "news-category";
          c.textContent = item.category;
          metaRow.appendChild(c);
        }

        if (item.pinned) {
          const p = document.createElement("span");
          p.className = "news-pinned";
          p.textContent = "Pinned";
          metaRow.appendChild(p);
        }

        if (metaRow.children.length) {
          main.appendChild(metaRow);
        }

        const title = document.createElement("h2");
        title.className = "news-title";
        if (item.url) {
          const a = document.createElement("a");
          a.href = item.url;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.textContent = item.title || "Untitled update";
          title.appendChild(a);
        } else {
          title.textContent = item.title || "Untitled update";
        }
        main.appendChild(title);

        if (item.summary) {
          const summary = document.createElement("p");
          summary.className = "news-summary";
          summary.textContent = item.summary;
          main.appendChild(summary);
        }

        card.appendChild(main);

        if (item.url) {
          const actions = document.createElement("div");
          actions.className = "news-actions";

          const linkBtn = document.createElement("a");
          linkBtn.className = "news-link-btn";
          linkBtn.href = item.url;
          linkBtn.target = "_blank";
          linkBtn.rel = "noopener noreferrer";
          linkBtn.innerHTML = '<span>Open link</span><span aria-hidden="true">↗</span>';
          actions.appendChild(linkBtn);

          const origin = originFromUrl(item.url);
          if (origin) {
            const originSpan = document.createElement("div");
            originSpan.className = "news-origin";
            originSpan.textContent = origin;
            actions.appendChild(originSpan);
          }

          card.appendChild(actions);
        }

        newsListEl.appendChild(card);
      }
    }

    async function loadNews() {
      if (!db) {
        statusLoading.style.display = "none";
        statusError.style.display = "flex";
        return;
      }

      try {
        const q = query(
          collection(db, "news"),
          orderBy("Date", "desc")
        );
        const snap = await getDocs(q);
        const items = [];
        snap.forEach((doc) => {
          const data = doc.data();
          const normalised = {
            title: data.title || data.Title || "Untitled update",
            summary: data.summary || data.Summary || "",
            url: data.url || data.URL || "",
            category: data.category || data.Category || "",
            pinned: (data.pinned !== undefined)
              ? data.pinned
              : (data.Pinned !== undefined ? data.Pinned : false),
            date: data.date || data.Date || null
          };
          items.push(normalised);
        });
        // Sort pinned items to the top client-side
        items.sort((a, b) => {
          const bp = b.pinned ? 1 : 0;
          const ap = a.pinned ? 1 : 0;
          if (bp !== ap) return bp - ap;
          const bd = b.date && b.date.toDate ? b.date.toDate().getTime() : 0;
          const ad = a.date && a.date.toDate ? a.date.toDate().getTime() : 0;
          return bd - ad;
        });
        allItems = items;
        statusLoading.style.display = "none";
        statusError.style.display = "none";
        applyFilter("all");
      } catch (err) {
        console.error("Error loading news:", err);
        statusLoading.style.display = "none";
        statusError.style.display = "flex";
      }
    }

    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => applyFilter(btn.dataset.filter));
    });

    loadNews();
  </script>
</body>
</html>
